#!/usr/bin/env bash

# mx-kill
# --------------------------------------------------------------------------------------------------
#
# Description
# -----------
# Switch to another tmux/mx session and kill the current one
# --------------------------------------------------------------------------------------------------

# Contributors
# ------------
# Filipe Kiss <eu@filipekiss.com.br> http://github.com/filipekiss
# --------------------------------------------------------------------------------------------------
#
# Version
# -------
# 0.2.0
# --------------------------------------------------------------------------------------------------
#
# Usage
# -----
# mx-kill <session name>
# --------------------------------------------------------------------------------------------------

mx_kill() {
    if [[ $# -eq 0 ]]; then
        tmux kill-session
        exit 0
    fi
    SESSION="$1"
    PROJECT="$2"
    

if ! (tmux has-session -t "${SESSION}" >/dev/null 2>&1); then
    if [ -z ${PROJECT:-} ]; then
    echo "No session named ${SESSION}"
    exit 1
    fi
    mx "$SESSION" "$PROJECT"
    exit $?
else
    if [ -z "$TMUX" ]; then
        tmux attach -t "$SESSION"
    else
        tmux switch-client -t "$SESSION"
        [[ -z $2 ]] && tmux kill-session
    fi
fi
}

mx_kill "$@"
